<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<title>DocumentaciÃ³n</title>

<script src="https://cdnjs.cloudflare.com/ajax/libs/pdf.js/3.11.174/pdf.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jszip/3.10.1/jszip.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/FileSaver.js/2.0.5/FileSaver.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>

<style>
body { font-family: Arial; }
.doc-item {
  border: 1px solid #ccc;
  padding: 10px;
  margin: 8px 0;
  display: flex;
  align-items: center;
  gap: 10px;
}
.doc-item img, .doc-item canvas {
  width: 80px;
  height: auto;
  border: 1px solid #999;
}
.doc-controls button {
  margin-left: 5px;
}
</style>
</head>

<body>

<h3>ðŸ“Ž DocumentaciÃ³n</h3>

<input type="file" id="fileInput" multiple accept=".pdf,image/*">
<div id="listaDocs"></div>

<hr>

<label>
<input type="radio" name="salida" value="pdf" checked>
Generar un solo PDF
</label>

<label>
<input type="radio" name="salida" value="zip">
Generar ZIP con archivos separados
</label>

<br><br>
<button onclick="generarSalida()">Generar</button>

<script>
pdfjsLib.GlobalWorkerOptions.workerSrc =
  "https://cdnjs.cloudflare.com/ajax/libs/pdf.js/3.11.174/pdf.worker.min.js";

let documentos = [];

document.getElementById("fileInput").addEventListener("change", manejarArchivos);

function manejarArchivos(e) {
  for (const file of e.target.files) {
    const tipo = file.type.startsWith("image") ? "image" : "pdf";
    const preview = URL.createObjectURL(file);

    documentos.push({
      file,
      name: file.name,
      type: tipo,
      preview
    });
  }
  render();
}

function render() {
  const cont = document.getElementById("listaDocs");
  cont.innerHTML = "";

  documentos.forEach((doc, i) => {
    const div = document.createElement("div");
    div.className = "doc-item";

    if (doc.type === "image") {
      const img = document.createElement("img");
      img.src = doc.preview;
      div.appendChild(img);
    } else {
      const canvas = document.createElement("canvas");
      canvas.width = 80;
      canvas.height = 100;
      div.appendChild(canvas);
      renderPDFThumb(doc.file, canvas);
    }

    const input = document.createElement("input");
    input.value = doc.name;
    input.oninput = e => doc.name = e.target.value;
    div.appendChild(input);

    const controls = document.createElement("div");
    controls.className = "doc-controls";

    controls.innerHTML = `
      <button onclick="mover(${i},-1)">â†‘</button>
      <button onclick="mover(${i},1)">â†“</button>
      <button onclick="eliminar(${i})">ðŸ—‘</button>
    `;

    div.appendChild(controls);
    cont.appendChild(div);
  });
}

function mover(i, dir) {
  const nuevo = i + dir;
  if (nuevo < 0 || nuevo >= documentos.length) return;
  [documentos[i], documentos[nuevo]] = [documentos[nuevo], documentos[i]];
  render();
}

function eliminar(i) {
  documentos.splice(i, 1);
  render();
}

async function renderPDFThumb(file, canvas) {
  const data = await file.arrayBuffer();
  const pdf = await pdfjsLib.getDocument({ data }).promise;
  const page = await pdf.getPage(1);
  const viewport = page.getViewport({ scale: 0.2 });
  canvas.width = viewport.width;
  canvas.height = viewport.height;
  await page.render({ canvasContext: canvas.getContext("2d"), viewport }).promise;
}

async function generarSalida() {
  const tipo = document.querySelector('input[name="salida"]:checked').value;

  if (tipo === "zip") {
    const zip = new JSZip();
    documentos.forEach(d => zip.file(d.name, d.file));
    const blob = await zip.generateAsync({ type: "blob" });
    saveAs(blob, "documentacion.zip");
  } else {
    const { jsPDF } = window.jspdf;
    const pdf = new jsPDF();

    for (let i = 0; i < documentos.length; i++) {
      const d = documentos[i];
      if (i > 0) pdf.addPage();

      if (d.type === "image") {
        const img = await cargarImagen(d.preview);
        pdf.addImage(img, "JPEG", 10, 10, 190, 0);
      } else {
        const data = await d.file.arrayBuffer();
        const srcPdf = await pdfjsLib.getDocument({ data }).promise;
        const page = await srcPdf.getPage(1);
        const viewport = page.getViewport({ scale: 1.5 });
        const canvas = document.createElement("canvas");
        canvas.width = viewport.width;
        canvas.height = viewport.height;
        await page.render({ canvasContext: canvas.getContext("2d"), viewport }).promise;
        pdf.addImage(canvas.toDataURL("image/jpeg"), "JPEG", 10, 10, 190, 0);
      }
    }

    pdf.save("documentacion.pdf");
  }
}

function cargarImagen(src) {
  return new Promise(res => {
    const img = new Image();
    img.onload = () => res(img);
    img.src = src;
  });
}
</script>

</body>
</html>


















