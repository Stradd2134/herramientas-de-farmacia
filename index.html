<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <title>Herramientas Diabetes</title>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/pdf-lib/1.17.1/pdf-lib.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jszip/3.10.1/jszip.min.js"></script>
  <style>
    body { font-family: Arial, sans-serif; margin: 20px; }
    .tabs button { margin-right: 10px; }
    .tab { display: none; }
    .tab.active { display: block; }
    .preview { display: flex; flex-wrap: wrap; gap: 10px; }
    .file-card { border: 1px solid #ccc; padding: 10px; width: 150px; }
    .file-card img { width: 100%; height: auto; }
  </style>
</head>
<body>

<h1>Página General – Herramientas</h1>

<div class="tabs">
  <button onclick="openTab('general')">General</button>
  <button onclick="openTab('documentacion')">Documentación</button>
</div>

<div id="general" class="tab active">
  <h2>Calculadora Diabetes</h2>
  <label>Unidades diarias: <input id="unidades" type="number"></label>
  <label>Días: <input id="dias" type="number"></label>
  <button onclick="calcular()">Calcular</button>
  <p id="resultado"></p>
</div>

<div id="documentacion" class="tab">
  <h2>Herramientas PDF / Imágenes</h2>

  <input type="file" id="files" multiple accept="application/pdf,image/*" />
  <br><br>

  <div class="preview" id="preview"></div>

  <br>
  <label>
    <input type="radio" name="salida" value="pdf" checked> Un solo PDF
  </label>
  <label>
    <input type="radio" name="salida" value="zip"> ZIP con archivos separados
  </label>
  <br><br>
  <button onclick="generarSalida()">Generar</button>
</div>

<script>
let archivos = [];

function openTab(id) {
  document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
  document.getElementById(id).classList.add('active');
}

function calcular() {
  const u = Number(unidades.value);
  const d = Number(dias.value);
  if (!u || !d) return;
  const total = u * d;
  const cajasExactas = total / 300;
  const cajasRedondeo = Math.ceil(cajasExactas);
  resultado.textContent = `Exacto: ${cajasExactas.toFixed(2)} cajas – A pedir: ${cajasRedondeo} cajas`;
}

files.addEventListener('change', () => {
  archivos = Array.from(files.files).map(f => ({ file: f, name: f.name }));
  renderPreview();
});

function renderPreview() {
  preview.innerHTML = '';
  archivos.forEach((obj, i) => {
    const div = document.createElement('div');
    div.className = 'file-card';

    if (obj.file.type.startsWith('image')) {
      const img = document.createElement('img');
      img.src = URL.createObjectURL(obj.file);
      div.appendChild(img);
    } else {
      div.innerHTML += '<div style="height:100px;background:#eee;text-align:center;line-height:100px">PDF</div>';
    }

    const input = document.createElement('input');
    input.value = obj.name;
    input.onchange = e => obj.name = e.target.value;

    const up = document.createElement('button'); up.textContent = '↑'; up.onclick = () => mover(i, -1);
    const down = document.createElement('button'); down.textContent = '↓'; down.onclick = () => mover(i, 1);
    const del = document.createElement('button'); del.textContent = 'X'; del.onclick = () => borrar(i);

    div.appendChild(input);
    div.appendChild(up); div.appendChild(down); div.appendChild(del);
    preview.appendChild(div);
  });
}

function mover(i, dir) {
  const j = i + dir;
  if (j < 0 || j >= archivos.length) return;
  [archivos[i], archivos[j]] = [archivos[j], archivos[i]];
  renderPreview();
}

function borrar(i) {
  archivos.splice(i, 1);
  renderPreview();
}

async function generarSalida() {
  const tipo = document.querySelector('input[name="salida"]:checked').value;

  if (tipo === 'zip') {
    const zip = new JSZip();
    archivos.forEach(a => zip.file(a.name, a.file));
    const blob = await zip.generateAsync({ type: 'blob' });
    descargar(blob, 'documentos.zip');
  } else {
    const pdfDoc = await PDFLib.PDFDocument.create();

    for (const a of archivos) {
      if (a.file.type === 'application/pdf') {
        const bytes = await a.file.arrayBuffer();
        const src = await PDFLib.PDFDocument.load(bytes);
        const pages = await pdfDoc.copyPages(src, src.getPageIndices());
        pages.forEach(p => pdfDoc.addPage(p));
      } else if (a.file.type.startsWith('image')) {
        const bytes = await a.file.arrayBuffer();
        const img = a.file.type.includes('png') ? await pdfDoc.embedPng(bytes) : await pdfDoc.embedJpg(bytes);
        const page = pdfDoc.addPage([img.width, img.height]);
        page.drawImage(img, { x: 0, y: 0, width: img.width, height: img.height });
      }
    }

    const finalPdf = await pdfDoc.save();
    descargar(new Blob([finalPdf], { type: 'application/pdf' }), 'documento.pdf');
  }
}

function descargar(blob, nombre) {
  const a = document.createElement('a');
  a.href = URL.createObjectURL(blob);
  a.download = nombre;
  a.click();
}
</script>

</body>
</html>



















