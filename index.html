<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<title>Gestión Diabetes</title>

<!-- PDF LIB -->
<script src="https://unpkg.com/pdf-lib/dist/pdf-lib.min.js"></script>

<!-- PDF.js -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/pdf.js/3.11.174/pdf.min.js"></script>

<style>
body {
  font-family: Arial, sans-serif;
  background: #1e1e1e;
  color: #fff;
  padding: 20px;
}

button {
  padding: 6px 12px;
  margin: 4px;
  cursor: pointer;
}

.tab {
  display: inline-block;
  margin-right: 10px;
  cursor: pointer;
  font-weight: bold;
}

.tab-content {
  display: none;
  margin-top: 20px;
}

.active {
  display: block;
}

/* PDF tools */
.pdf-page {
  background: #ffffff;
  color: #000;
  display: flex;
  align-items: center;
  gap: 12px;
  padding: 8px;
  margin-bottom: 8px;
  border-radius: 6px;
}

.pdf-thumb {
  width: 90px;
  border: 1px solid #999;
}
</style>
</head>

<body>

<h1>Gestión de Diabetes</h1>

<div>
  <span class="tab" onclick="mostrar('general')">General</span>
  <span class="tab" onclick="mostrar('diabetes')">Diabetes</span>
</div>

<!-- GENERAL -->
<div id="general" class="tab-content active">

  <h2>Documentación</h2>

  <h3>Herramientas PDF</h3>

  <input type="file" id="pdfInput" accept="application/pdf">

  <div id="pdfPages" style="margin-top:15px"></div>

  <button onclick="exportarPDFEditado()">Generar PDF corregido</button>
  <p id="estadoPdf"></p>

</div>

<!-- DIABETES -->
<div id="diabetes" class="tab-content">
  <h2>Calculadoras de Diabetes</h2>
  <p>(sin cambios)</p>
</div>

<script>
function mostrar(id) {
  document.querySelectorAll(".tab-content").forEach(t => t.classList.remove("active"));
  document.getElementById(id).classList.add("active");
}

/* =========================
   PDF CON MINIATURAS
========================= */

pdfjsLib.GlobalWorkerOptions.workerSrc =
  "https://cdnjs.cloudflare.com/ajax/libs/pdf.js/3.11.174/pdf.worker.min.js";

let pdfOriginal = null;
let pdfJS = null;
let paginasPDF = [];

document.getElementById("pdfInput").addEventListener("change", async e => {
  const file = e.target.files[0];
  if (!file) return;

  const bytes = await file.arrayBuffer();

  pdfOriginal = await PDFLib.PDFDocument.load(bytes);
  pdfJS = await pdfjsLib.getDocument({ data: bytes }).promise;

  paginasPDF = pdfOriginal.getPageIndices();
  renderizarPaginas();
});

async function renderizarPaginas() {
  const cont = document.getElementById("pdfPages");
  cont.innerHTML = "";

  for (let i = 0; i < paginasPDF.length; i++) {
    const numPagina = paginasPDF[i];
    const div = document.createElement("div");
    div.className = "pdf-page";

    const canvas = document.createElement("canvas");
    canvas.className = "pdf-thumb";

    const page = await pdfJS.getPage(numPagina + 1);
    const viewport = page.getViewport({ scale: 0.25 });
    const ctx = canvas.getContext("2d");
    canvas.width = viewport.width;
    canvas.height = viewport.height;

    await page.render({ canvasContext: ctx, viewport }).promise;

    div.appendChild(canvas);

    const info = document.createElement("span");
    info.textContent = `Página ${numPagina + 1}`;
    div.appendChild(info);

    const up = document.createElement("button");
    up.textContent = "↑";
    up.onclick = () => subirPagina(i);
    div.appendChild(up);

    const down = document.createElement("button");
    down.textContent = "↓";
    down.onclick = () => bajarPagina(i);
    div.appendChild(down);

    const del = document.createElement("button");
    del.textContent = "Eliminar";
    del.onclick = () => eliminarPagina(i);
    div.appendChild(del);

    cont.appendChild(div);
  }
}

function subirPagina(i) {
  if (i === 0) return;
  [paginasPDF[i - 1], paginasPDF[i]] = [paginasPDF[i], paginasPDF[i - 1]];
  renderizarPaginas();
}

function bajarPagina(i) {
  if (i === paginasPDF.length - 1) return;
  [paginasPDF[i + 1], paginasPDF[i]] = [paginasPDF[i], paginasPDF[i + 1]];
  renderizarPaginas();
}

function eliminarPagina(i) {
  paginasPDF.splice(i, 1);
  renderizarPaginas();
}

async function exportarPDFEditado() {
  if (!pdfOriginal || paginasPDF.length === 0) {
    alert("No hay páginas");
    return;
  }

  document.getElementById("estadoPdf").textContent = "Generando PDF…";

  const nuevoPDF = await PDFLib.PDFDocument.create();
  const paginas = await nuevoPDF.copyPages(pdfOriginal, paginasPDF);
  paginas.forEach(p => nuevoPDF.addPage(p));

  const bytes = await nuevoPDF.save();
  descargar(bytes, "pdf_corregido.pdf");

  document.getElementById("estadoPdf").textContent = "PDF generado correctamente.";
}

function descargar(bytes, nombre) {
  const blob = new Blob([bytes], { type: "application/pdf" });
  const link = document.createElement("a");
  link.href = URL.createObjectURL(blob);
  link.download = nombre;
  link.click();
}
</script>

</body>
</html>
















