<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<title>Generador de Documentación PDF</title>

<script src="https://cdn.jsdelivr.net/npm/pdf-lib@1.17.1/dist/pdf-lib.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/jszip@3.10.1/dist/jszip.min.js"></script>

<style>
body{font-family:Arial;padding:20px}
.lista{margin-top:15px}
.item{border:1px solid #ccc;padding:8px;margin-bottom:5px;display:flex;align-items:center;gap:5px}
.item input{flex:1}
button{cursor:pointer}
</style>
</head>

<body>

<h2>Generador de Documentos – Diabetes</h2>

<input type="file" id="archivos" multiple accept=".pdf,image/*">
<div class="lista" id="lista"></div>

<hr>

<h3>Salida</h3>
<label>
  <input type="radio" name="salida" value="pdf" checked>
  Un solo PDF
</label><br>
<label>
  <input type="radio" name="salida" value="zip">
  ZIP con PDFs separados
</label>

<br><br>
<button onclick="generarSalida()">Generar</button>

<p id="estado"></p>

<script>
let archivosCargados = [];

document.getElementById("archivos").addEventListener("change", e=>{
  for(const file of e.target.files){
    archivosCargados.push({
      file,
      nombre: file.name.replace(/\.[^/.]+$/, "")
    });
  }
  render();
});

function render(){
  const cont = document.getElementById("lista");
  cont.innerHTML = "";

  archivosCargados.forEach((obj,i)=>{
    const div = document.createElement("div");
    div.className="item";

    div.innerHTML = `
      <input value="${obj.nombre}" onchange="renombrar(${i},this.value)">
      <button onclick="subir(${i})">↑</button>
      <button onclick="bajar(${i})">↓</button>
      <button onclick="eliminar(${i})">✕</button>
    `;
    cont.appendChild(div);
  });
}

function renombrar(i,val){
  archivosCargados[i].nombre = val;
}

function subir(i){
  if(i===0)return;
  [archivosCargados[i-1],archivosCargados[i]]=[archivosCargados[i],archivosCargados[i-1]];
  render();
}

function bajar(i){
  if(i===archivosCargados.length-1)return;
  [archivosCargados[i+1],archivosCargados[i]]=[archivosCargados[i],archivosCargados[i+1]];
  render();
}

function eliminar(i){
  archivosCargados.splice(i,1);
  render();
}

async function generarSalida(){
  const tipo=document.querySelector('input[name="salida"]:checked').value;
  document.getElementById("estado").textContent="Procesando…";

  if(tipo==="pdf"){
    await generarPDF();
  }else{
    await generarZIP();
  }
}

async function generarPDF(){
  const pdfFinal=await PDFLib.PDFDocument.create();

  for(const obj of archivosCargados){
    const f=obj.file;
    if(f.type.includes("pdf")){
      const bytes=await f.arrayBuffer();
      const pdf=await PDFLib.PDFDocument.load(bytes);
      const pages=await pdfFinal.copyPages(pdf,pdf.getPageIndices());
      pages.forEach(p=>pdfFinal.addPage(p));
    }else if(f.type.startsWith("image")){
      const imgBytes=await f.arrayBuffer();
      const img=f.type.includes("png")
        ?await pdfFinal.embedPng(imgBytes)
        :await pdfFinal.embedJpg(imgBytes);
      const page=pdfFinal.addPage([img.width,img.height]);
      page.drawImage(img,{x:0,y:0,width:img.width,height:img.height});
    }
  }

  descargar(new Blob([await pdfFinal.save()],{type:"application/pdf"}),"documentacion.pdf");
}

async function generarZIP(){
  const zip=new JSZip();

  for(const obj of archivosCargados){
    const f=obj.file;
    if(f.type.includes("pdf")){
      zip.file(obj.nombre+".pdf",await f.arrayBuffer());
    }else if(f.type.startsWith("image")){
      const pdf=await PDFLib.PDFDocument.create();
      const imgBytes=await f.arrayBuffer();
      const img=f.type.includes("png")
        ?await pdf.embedPng(imgBytes)
        :await pdf.embedJpg(imgBytes);
      const page=pdf.addPage([img.width,img.height]);
      page.drawImage(img,{x:0,y:0,width:img.width,height:img.height});
      zip.file(obj.nombre+".pdf",await pdf.save());
    }
  }

  descargar(await zip.generateAsync({type:"blob"}),"documentacion.zip");
}

function descargar(blob,nombre){
  const a=document.createElement("a");
  a.href=URL.createObjectURL(blob);
  a.download=nombre;
  a.click();
  URL.revokeObjectURL(a.href);
  document.getElementById("estado").textContent="Listo.";
}
</script>

</body>
</html>






