<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8" />
<link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;500;600;700&display=swap" rel="stylesheet">
<title>FarmaTools</title>

<!-- LIBRER√çAS -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/pdf.js/3.11.174/pdf.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jszip/3.10.1/jszip.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/FileSaver.js/2.0.5/FileSaver.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>

<style>
body {
  margin: 0;
  font-family: 'Poppins', sans-serif;
  background-color: #d1d5db;
  color: #1f2937;
  display: flex;
  height: 100vh;
}

/* SIDEBAR */
.sidebar {
  width: 240px;
  background: #14532d;
  padding: 20px 0;
  height: 100vh;
  box-sizing: border-box;
  color: white;
  display: flex;
  flex-direction: column;
}

.accordion {
  background: #14532d;
  border: none;
  color: white;
  cursor: pointer;
  padding: 14px 20px;
  width: 100%;
  font-size: 14px;
  text-align: left;
}

.accordion:hover { background: #15803d; }

.accordion-content {
  display: none;
  flex-direction: column;
  background: #1b5e34;
}

.tab {
  padding: 12px 30px;
  font-size: 14px;
  cursor: pointer;
  color: white;
}

.tab:hover { background: rgba(255,255,255,0.08); }
.tab.active { background: rgba(255,255,255,0.15); font-weight:600; }

/* MAIN */
.main-content {
  flex: 1;
  display: flex;
  flex-direction: column;
  padding: 0 40px 40px 40px;
  overflow-y: auto;
}

/* HEADER */
.header {
  height: 150px;
  background: white;
  display: flex;
  align-items: center;
  padding: 0 30px;
  box-shadow: 0 4px 20px rgba(0,0,0,0.08);
  border: 1px solid #e5e7eb;
}

.header h1 {
  font-size: 60px;
  margin: 0;
}

.subtitle {
  font-size: 20px;
  color: #6b7280;
}

/* CARDS */
.tab-content {
  display: none;
  background: white;
  padding: 25px;
  border-radius: 12px;
  box-shadow: 0 4px 14px rgba(0,0,0,0.06);
  margin-top: 20px;
}

.tab-content.active { display:block; }

input, select {
  padding: 8px 10px;
  margin: 6px 0;
  border-radius: 6px;
  border: 1px solid #d1d5db;
}

button {
  padding: 8px 14px;
  margin: 6px 4px 6px 0;
  border-radius: 8px;
  border: none;
  background: #2563eb;
  color: white;
  cursor: pointer;
}

button:hover { background:#1d4ed8; }

.page {
  display:inline-block;
  margin:8px;
  text-align:center;
}

.page canvas, .page img {
  width:110px;
  border-radius:6px;
  border:1px solid #e5e7eb;
}
</style>
</head>

<body>

<!-- SIDEBAR -->
<div class="sidebar">
  <button class="accordion" onclick="toggleAccordion('diabetes')">DIABETES</button>
  <div id="diabetes" class="accordion-content">
    <div class="tab" onclick="mostrarSolapa(event,'solapaFechas')">Fechas</div>
    <div class="tab" onclick="mostrarSolapa(event,'solapaInsulina')">Insulina</div>
  </div>

  <button class="accordion" onclick="toggleAccordion('general')">GENERAL</button>
  <div id="general" class="accordion-content">
    <div class="tab" onclick="mostrarSolapa(event,'solapaGeneral')">Cal. Fechas</div>
    <div class="tab" onclick="mostrarSolapa(event,'solapaDocumentacion')">Documentaci√≥n</div>
  </div>
</div>

<!-- MAIN -->
<div class="main-content">
  <div class="header">
    <div>
      <h1>FarmaTools</h1>
      <div class="subtitle">Gesti√≥n y an√°lisis farmac√©utico</div>
    </div>
  </div>

  <!-- FECHAS -->
  <div id="solapaFechas" class="tab-content">
    <h2>D√≠as desde fecha</h2>
    <input id="fechaInput" placeholder="dd/mm/aaaa">
    <button onclick="compararFechas()">Calcular</button>
    <div id="resultado"></div>
  </div>

  <!-- INSULINA -->
  <div id="solapaInsulina" class="tab-content">
    <h2>C√°lculo de Insulina</h2>

    <select id="tipoInsulina">
      <option value="">Seleccionar insulina</option>
      <option value="1800">INSULINA TRESIBA FLEXTOUCH</option>
      <option value="1500">INSULINA NOVORAPID FLEXPEN</option>
      <option value="1500">INSULINA LANTUS SOLOSTAR</option>
      <option value="1500">INSULINA APIDRA SOLOSTAR</option>
      <option value="1500">INSULINA OPTISULIN SOLOSTAR</option>
      <option value="1350">TOUJEO (300 U/ml)</option>
    </select>

    <input id="unidadesDiarias" type="number" min="1" placeholder="Unidades diarias">

    <select id="periodoInsulina">
      <option value="">Seleccionar per√≠odo</option>
      <option value="30">1 mes</option>
      <option value="60">2 meses</option>
      <option value="90">3 meses</option>
      <option value="180">6 meses</option>
      <option value="365">1 a√±o</option>
    </select>

    <button onclick="calcularInsulina()">Calcular</button>
    <div id="resultadoInsulina"></div>
  </div>

  <!-- GENERAL -->
  <div id="solapaGeneral" class="tab-content">
    <h2>Calculadora general</h2>
    <input id="fechaGeneral" placeholder="dd/mm/aaaa">
    <input id="diasGeneral" type="number" placeholder="d√≠as">
    <button onclick="sumarFechaGeneral()">Sumar</button>
    <button onclick="restarFechaGeneral()">Restar</button>
    <div id="resultadoFechaGeneral"></div>
  </div>

  <!-- DOCUMENTACI√ìN -->
  <div id="solapaDocumentacion" class="tab-content">
    <h2>üìé Documentaci√≥n</h2>
    <input type="file" id="fileInput" multiple accept=".pdf,image/*"><br>
    <label><input type="radio" name="salida" value="pdf" checked> PDF √∫nico</label>
    <label><input type="radio" name="salida" value="zip"> ZIP</label>
    <select id="quality">
      <option value="1">Alta</option>
      <option value="0.8">Media</option>
      <option value="0.6">Baja</option>
    </select>
    <div id="preview" style="max-height:420px;overflow:auto"></div>
    <button onclick="generar()">Generar</button>
  </div>
</div>

<script>
pdfjsLib.GlobalWorkerOptions.workerSrc =
"https://cdnjs.cloudflare.com/ajax/libs/pdf.js/3.11.174/pdf.worker.min.js";

/* ================= UI ================= */
function mostrarSolapa(e,id){
 document.querySelectorAll('.tab-content').forEach(t=>t.classList.remove('active'));
 document.getElementById(id).classList.add('active');
 document.querySelectorAll('.tab').forEach(t=>t.classList.remove('active'));
 e.target.classList.add('active');
}
function toggleAccordion(id){
 const el=document.getElementById(id);
 el.style.display=el.style.display==='flex'?'none':'flex';
}

/* ================= DOCUMENTACI√ìN ================= */
let paginas=[];

document.getElementById("fileInput").onchange = async function(e){
 paginas=[];
 for(const f of e.target.files){

  if(f.type.startsWith("image")){
    paginas.push({
      tipo:"img",
      src:URL.createObjectURL(f),
      nombre:"documento",
      rot:0
    });

  } else if(f.type==="application/pdf"){

    const pdf=await pdfjsLib.getDocument({
      data:await f.arrayBuffer()
    }).promise;

    for(let i=1;i<=pdf.numPages;i++){
      const p=await pdf.getPage(i);
      const v=p.getViewport({scale:1});
      const c=document.createElement("canvas");
      c.width=v.width;
      c.height=v.height;

      await p.render({
        canvasContext:c.getContext("2d"),
        viewport:v
      }).promise;

      paginas.push({
        tipo:"pdf",
        canvas:c,
        nombre:"documento",
        rot:0
      });
    }
  }
 }
 render();
};

function render(){
 const preview=document.getElementById("preview");
 preview.innerHTML="";

 paginas.forEach((p,i)=>{
  const d=document.createElement("div");
  d.className="page";

  const el=p.tipo==="img"
    ? Object.assign(new Image(),{src:p.src})
    : p.canvas;

  el.style.transform=`rotate(${p.rot}deg)`;
  d.appendChild(el);

  const name=document.createElement("input");
  name.value=p.nombre;
  name.oninput=e=>p.nombre=e.target.value;
  d.appendChild(name);

  ["‚§æ","‚¨Ü","‚¨á","‚ùå"].forEach((t,j)=>{
    const b=document.createElement("button");
    b.textContent=t;
    b.onclick=()=>{
      if(j===0)p.rot=(p.rot+90)%360;
      if(j===1&&i>0)[paginas[i-1],paginas[i]]=[paginas[i],paginas[i-1]];
      if(j===2&&i<paginas.length-1)[paginas[i+1],paginas[i]]=[paginas[i],paginas[i+1]];
      if(j===3)paginas.splice(i,1);
      render();
    };
    d.appendChild(b);
  });

  preview.appendChild(d);
 });
}

async function generar(){
 if(paginas.length===0){
  alert("No hay archivos cargados.");
  return;
 }

 const {jsPDF}=window.jspdf;
 const salida=document.querySelector('[name=salida]:checked').value;
 const q=parseFloat(document.getElementById("quality").value);

 if(salida==="pdf"){
  const pdf=new jsPDF();
  let first=true;

  paginas.forEach(p=>{
    if(!first)pdf.addPage();
    first=false;

    const img=p.tipo==="img"
      ? p.src
      : p.canvas.toDataURL("image/jpeg",q);

    pdf.addImage(img,"JPEG",10,10,190,0);
  });

  pdf.save("documento.pdf");

 } else {

  const zip=new JSZip();
  const grupos={};

  paginas.forEach(p=>{
    if(!grupos[p.nombre])grupos[p.nombre]=[];
    grupos[p.nombre].push(p);
  });

  for(const n in grupos){
    const pdf=new jsPDF();
    let first=true;

    grupos[n].forEach(p=>{
      if(!first)pdf.addPage();
      first=false;

      const img=p.tipo==="img"
        ? p.src
        : p.canvas.toDataURL("image/jpeg",q);

      pdf.addImage(img,"JPEG",10,10,190,0);
    });

    zip.file(`${n}.pdf`,pdf.output("blob"));
  }

  const contenido=await zip.generateAsync({type:"blob"});
  saveAs(contenido,"documentos.zip");
 }
}

/* ================= INSULINA ================= */
function calcularInsulina(){
 const insulina=Number(tipoInsulina.value);
 const unidades=Number(unidadesDiarias.value);
 const dias=Number(periodoInsulina.value);

 if(!insulina||!unidades||!dias){
  resultadoInsulina.textContent="‚ö†Ô∏è Complet√° todos los campos.";
  return;
 }

 const total=unidades*dias;
 const exacto=total/insulina;
 const red=Math.ceil(exacto);

 resultadoInsulina.innerHTML=
  `üì¶ Cajas necesarias: <b>${red}</b>
   <span style="color:#6b7280">(exacto: ${exacto.toFixed(2)})</span>`;
}

/* ================= FECHAS ================= */
function compararFechas(){
 const [d,m,a]=fechaInput.value.split("/");
 const f=new Date(a,m-1,d);
 resultado.textContent=`${Math.floor((new Date()-f)/86400000)} d√≠as`;
}

function sumarFechaGeneral(){proc(1)}
function restarFechaGeneral(){proc(-1)}

function proc(s){
 const [d,m,a]=fechaGeneral.value.split("/");
 const f=new Date(a,m-1,d);
 f.setDate(f.getDate()+s*parseInt(diasGeneral.value));
 resultadoFechaGeneral.textContent=f.toLocaleDateString();
}
</script>


</body>
</html>













