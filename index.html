<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<title>Herramientas de Farmacia</title>

<script src="https://cdnjs.cloudflare.com/ajax/libs/pdf.js/3.11.174/pdf.min.js"></script>
<script src="https://unpkg.com/pdf-lib/dist/pdf-lib.min.js"></script>

<script>
pdfjsLib.GlobalWorkerOptions.workerSrc =
  "https://cdnjs.cloudflare.com/ajax/libs/pdf.js/3.11.174/pdf.worker.min.js";
</script>

<style>
body {
  margin: 0;
  font-family: Arial, sans-serif;
  background-color: #001f3f;
  color: white;
  display: flex;
}
.sidebar {
  width: 220px;
  background-color: #002b5c;
  padding: 20px;
  height: 100vh;
}
.accordion {
  background-color: #004080;
  color: white;
  cursor: pointer;
  padding: 12px;
  border: none;
  width: 100%;
  margin-bottom: 10px;
  border-radius: 4px;
}
.accordion-content {
  display: none;
  flex-direction: column;
}
.tab {
  background-color: #0059b3;
  margin-top: 5px;
  padding: 10px;
  border-radius: 4px;
  cursor: pointer;
}
.tab.active {
  background-color: #00cfff;
}
.main-content {
  flex-grow: 1;
  padding: 30px;
}
.tab-content {
  display: none;
  background-color: #003366;
  padding: 20px;
  border-radius: 5px;
}
.tab-content.active {
  display: block;
}
input, button, select {
  padding: 8px;
  margin: 5px 0;
  border-radius: 4px;
  border: none;
}
#pdfPages {
  max-height: 500px;
  overflow-y: auto;
}
.pdf-page {
  background: #004080;
  padding: 10px;
  margin-bottom: 10px;
  border-radius: 6px;
}
.pdf-thumb {
  display: block;
  margin-bottom: 8px;
  border: 1px solid #00cfff;
}
</style>
</head>

<body>

<div class="sidebar">
  <button class="accordion" onclick="toggleAccordion('diabetes')">DIABETES</button>
  <div id="diabetes" class="accordion-content">
    <div class="tab" onclick="mostrarSolapa(event,'solapaFechas')">Fechas</div>
    <div class="tab" onclick="mostrarSolapa(event,'solapaInsulina')">Insulina</div>
  </div>

  <button class="accordion" onclick="toggleAccordion('general')">GENERAL</button>
  <div id="general" class="accordion-content">
    <div class="tab" onclick="mostrarSolapa(event,'solapaGeneral')">Cal. Fechas</div>
    <div class="tab" onclick="mostrarSolapa(event,'solapaDocumentacion')">Documentación</div>
  </div>
</div>

<div class="main-content">
<h1 style="text-align:center;">HERRAMIENTAS DE FARMACIA</h1>

<div id="solapaFechas" class="tab-content">
  <input id="fechaInput" placeholder="dd/mm/aaaa">
  <button onclick="compararFechas()">Calcular</button>
  <button onclick="sumarDias()">Sumar 82 días</button>
  <div id="resultado"></div>
  <div id="resultadoSuma"></div>
</div>

<div id="solapaInsulina" class="tab-content">
  <select id="tipoInsulina">
    <option value="toujeo">TOUJEO</option>
    <option value="tresiba">TRESIBA</option>
    <option value="otra">OTRA</option>
  </select>
  <input id="valorInsulina" type="number" placeholder="Dosis diaria">
  <button onclick="calcularInsulina()">Calcular</button>
  <div id="resultadoInsulina"></div>
</div>

<div id="solapaGeneral" class="tab-content">
  <input id="fechaGeneral" placeholder="dd/mm/aaaa">
  <input id="diasGeneral" type="number" placeholder="Cantidad de días">
  <button onclick="sumarFechaGeneral()">Sumar</button>
  <button onclick="restarFechaGeneral()">Restar</button>
  <div id="resultadoFechaGeneral"></div>
</div>

<div id="solapaDocumentacion" class="tab-content">
  <h2>Herramientas PDF</h2>
  <input type="file" id="pdfInput" accept="application/pdf">
  <div id="pdfPages"></div>
  <button onclick="generarPDFEditado()">Generar PDF editado</button>
</div>
</div>

<script>
function toggleAccordion(id){
  const el=document.getElementById(id);
  el.style.display=el.style.display==="flex"?"none":"flex";
}
function mostrarSolapa(e,id){
  document.querySelectorAll('.tab-content').forEach(t=>t.classList.remove('active'));
  document.querySelectorAll('.tab').forEach(t=>t.classList.remove('active'));
  document.getElementById(id).classList.add('active');
  e.currentTarget.classList.add('active');
}

/* INSULINA */
function calcularInsulina(){
  const v=parseFloat(valorInsulina.value);
  const map={toujeo:1350,tresiba:1800,otra:1500};
  if(!v||v<=0){resultadoInsulina.textContent="Valor inválido";return;}
  const total=v*90;
  const exacto=(total/map[tipoInsulina.value]).toFixed(2);
  const red=Math.ceil(total/map[tipoInsulina.value]);
  resultadoInsulina.textContent=
    `Resultado: ${total} ÷ ${map[tipoInsulina.value]} = ${exacto} cajas (aprox. ${red})`;
}

/* PDF */
let pdfDoc,paginas=[],archivo,scrollPos=0;

pdfInput.onchange=async e=>{
  archivo=e.target.files[0];
  const buf=await archivo.arrayBuffer();
  pdfDoc=await pdfjsLib.getDocument({data:buf}).promise;
  paginas=[...Array(pdfDoc.numPages).keys()];
  renderPDF();
};

async function renderPDF(){
  scrollPos=pdfPages.scrollTop;
  pdfPages.innerHTML="";

  for(let i=0;i<paginas.length;i++){
    const page=await pdfDoc.getPage(paginas[i]+1);
    const viewport=page.getViewport({scale:0.3});

    const canvas=document.createElement("canvas");
    canvas.className="pdf-thumb";
    canvas.width=viewport.width;
    canvas.height=viewport.height;

    await page.render({
      canvasContext: canvas.getContext("2d"),
      viewport
    }).promise;

    const cont=document.createElement("div");
    cont.className="pdf-page";

    const label=document.createElement("div");
    label.textContent=`Página ${paginas[i]+1}`;

    const up=document.createElement("button");
    up.textContent="↑";
    up.onclick=()=>mover(i,-1);

    const down=document.createElement("button");
    down.textContent="↓";
    down.onclick=()=>mover(i,1);

    const del=document.createElement("button");
    del.textContent="Eliminar";
    del.onclick=()=>borrar(i);

    cont.append(canvas,label,up,down,del);
    pdfPages.append(cont);
  }
  pdfPages.scrollTop=scrollPos;
}

function mover(i,d){
  const j=i+d;if(j<0||j>=paginas.length)return;
  [paginas[i],paginas[j]]=[paginas[j],paginas[i]];
  renderPDF();
}
function borrar(i){
  paginas.splice(i,1);
  renderPDF();
}

async function generarPDFEditado(){
  const buf=await archivo.arrayBuffer();
  const orig=await PDFLib.PDFDocument.load(buf);
  const nuevo=await PDFLib.PDFDocument.create();
  for(const i of paginas){
    const [p]=await nuevo.copyPages(orig,[i]);
    nuevo.addPage(p);
  }
  const bytes=await nuevo.save();
  const a=document.createElement("a");
  a.href=URL.createObjectURL(new Blob([bytes],{type:"application/pdf"}));
  a.download="PDF_EDITADO.pdf";
  a.click();
}
</script>

</body>
</html>



















