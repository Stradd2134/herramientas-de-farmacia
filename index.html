<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<title>DocumentaciÃ³n</title>

<script src="https://cdnjs.cloudflare.com/ajax/libs/pdf.js/3.11.174/pdf.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jszip/3.10.1/jszip.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/FileSaver.js/2.0.5/FileSaver.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>

<style>
body { font-family: Arial; }
.doc {
  border: 1px solid #aaa;
  padding: 10px;
  margin-bottom: 15px;
}
.page {
  display: inline-block;
  margin: 6px;
  text-align: center;
}
.page canvas, .page img {
  width: 100px;
  border: 1px solid #999;
}
.page button {
  display: block;
  margin: 2px auto;
}
</style>
</head>

<body>

<h3>ðŸ“Ž DocumentaciÃ³n</h3>

<input type="file" multiple accept=".pdf,image/*" id="fileInput">
<div id="docs"></div>

<hr>

<label><input type="radio" name="out" value="pdf" checked> PDF Ãºnico</label>
<label><input type="radio" name="out" value="zip"> ZIP separado</label>
<br><br>
<button onclick="generar()">Generar</button>

<script>
pdfjsLib.GlobalWorkerOptions.workerSrc =
  "https://cdnjs.cloudflare.com/ajax/libs/pdf.js/3.11.174/pdf.worker.min.js";

let documentos = [];

document.getElementById("fileInput").onchange = async e => {
  for (const file of e.target.files) {
    if (file.type.startsWith("image")) {
      documentos.push({
        name: file.name,
        pages: [{
          type: "image",
          src: URL.createObjectURL(file)
        }]
      });
    } else {
      await cargarPDF(file);
    }
  }
  render();
};

async function cargarPDF(file) {
  const data = await file.arrayBuffer();
  const pdf = await pdfjsLib.getDocument({ data }).promise;
  const pages = [];

  for (let i = 1; i <= pdf.numPages; i++) {
    const page = await pdf.getPage(i);
    const viewport = page.getViewport({ scale: 0.3 });
    const canvas = document.createElement("canvas");
    canvas.width = viewport.width;
    canvas.height = viewport.height;
    await page.render({ canvasContext: canvas.getContext("2d"), viewport }).promise;
    pages.push({ type: "pdf", canvas });
  }

  documentos.push({ name: file.name, pages });
}

function moverPagina(doc, i, dir) {
  const nuevo = i + dir;
  if (nuevo < 0 || nuevo >= doc.pages.length) return;
  [doc.pages[i], doc.pages[nuevo]] = [doc.pages[nuevo], doc.pages[i]];
  render();
}

function render() {
  const cont = document.getElementById("docs");
  cont.innerHTML = "";

  documentos.forEach((doc, d) => {
    const div = document.createElement("div");
    div.className = "doc";

    const name = document.createElement("input");
    name.value = doc.name;
    name.oninput = e => doc.name = e.target.value;
    div.appendChild(name);

    doc.pages.forEach((p, i) => {
      const pageDiv = document.createElement("div");
      pageDiv.className = "page";

      if (p.type === "image") {
        const img = document.createElement("img");
        img.src = p.src;
        pageDiv.appendChild(img);
      } else {
        pageDiv.appendChild(p.canvas);
      }

      const up = document.createElement("button");
      up.textContent = "â¬†";
      up.onclick = () => moverPagina(doc, i, -1);

      const down = document.createElement("button");
      down.textContent = "â¬‡";
      down.onclick = () => moverPagina(doc, i, 1);

      const del = document.createElement("button");
      del.textContent = "âŒ";
      del.onclick = () => {
        doc.pages.splice(i, 1);
        if (doc.pages.length === 0) documentos.splice(d, 1);
        render();
      };

      pageDiv.append(up, down, del);
      div.appendChild(pageDiv);
    });

    cont.appendChild(div);
  });
}

async function generar() {
  const tipo = document.querySelector('input[name="out"]:checked').value;

  if (tipo === "zip") {
    const zip = new JSZip();
    documentos.forEach(d => zip.file(d.name, "Contenido generado"));
    saveAs(await zip.generateAsync({ type: "blob" }), "documentos.zip");
  } else {
    const { jsPDF } = window.jspdf;
    const pdf = new jsPDF();
    let first = true;

    documentos.forEach(d => {
      d.pages.forEach(p => {
        if (!first) pdf.addPage();
        first = false;

        if (p.type === "image") {
          pdf.addImage(p.src, "JPEG", 10, 10, 190, 0);
        } else {
          pdf.addImage(p.canvas.toDataURL("image/jpeg"), "JPEG", 10, 10, 190, 0);
        }
      });
    });

    pdf.save("documentacion.pdf");
  }
}
</script>

</body>
</html>
















