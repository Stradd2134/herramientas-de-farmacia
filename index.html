<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<title>Herramientas de Documentaci√≥n</title>

<script src="https://unpkg.com/pdf-lib/dist/pdf-lib.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/pdf.js/3.11.174/pdf.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/Sortable/1.15.2/Sortable.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jszip/3.10.1/jszip.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/FileSaver.js/2.0.5/FileSaver.min.js"></script>

<style>
body { font-family: Arial; background:#f5f5f5; padding:20px }
h2 { margin-top:0 }

#preview { display:flex; flex-wrap:wrap; gap:10px }
.item {
  background:#fff;
  border:1px solid #ccc;
  padding:8px;
  width:150px;
  text-align:center;
}
.item img { width:100%; height:auto; border:1px solid #ddd }
.item input { width:100%; margin-top:5px }
button { margin-top:10px }
</style>
</head>

<body>

<h2>üìÅ Documentaci√≥n ‚Äì Generador PDF</h2>

<input type="file" id="fileInput" multiple accept="application/pdf,image/*">
<br><br>

<div id="preview"></div>

<br>
<label>
  <input type="radio" name="output" value="pdf" checked>
  Un solo PDF
</label>
<label>
  <input type="radio" name="output" value="zip">
  ZIP con archivos separados
</label>

<br><br>
<button onclick="generar()">üìÑ Generar</button>

<script>
pdfjsLib.GlobalWorkerOptions.workerSrc =
  "https://cdnjs.cloudflare.com/ajax/libs/pdf.js/3.11.174/pdf.worker.min.js";

const filesData = [];
const preview = document.getElementById("preview");

document.getElementById("fileInput").addEventListener("change", async e => {
  for (const file of e.target.files) {
    if (file.type === "application/pdf") {
      await cargarPDF(file);
    } else if (file.type.startsWith("image/")) {
      cargarImagen(file);
    }
  }
});

async function cargarPDF(file) {
  const buffer = await file.arrayBuffer();
  const pdf = await pdfjsLib.getDocument({ data: buffer }).promise;

  for (let i = 1; i <= pdf.numPages; i++) {
    const page = await pdf.getPage(i);
    const viewport = page.getViewport({ scale: 1.2 });

    const canvas = document.createElement("canvas");
    const ctx = canvas.getContext("2d");
    canvas.width = viewport.width;
    canvas.height = viewport.height;

    await page.render({ canvasContext: ctx, viewport }).promise;

    agregarItem(canvas.toDataURL(), file, i);
  }
}

function cargarImagen(file) {
  const reader = new FileReader();
  reader.onload = e => agregarItem(e.target.result, file, null);
  reader.readAsDataURL(file);
}

function agregarItem(src, file, page) {
  const div = document.createElement("div");
  div.className = "item";

  div.innerHTML = `
    <img src="${src}">
    <input value="${file.name.replace(/\.[^/.]+$/, "")}">
  `;

  preview.appendChild(div);

  filesData.push({
    file,
    page,
    input: div.querySelector("input")
  });
}

new Sortable(preview, { animation: 150 });

async function generar() {
  const tipo = document.querySelector("input[name=output]:checked").value;

  if (tipo === "pdf") {
    const pdfFinal = await PDFLib.PDFDocument.create();

    for (const item of filesData) {
      if (item.file.type === "application/pdf") {
        const bytes = await item.file.arrayBuffer();
        const pdfOrigen = await PDFLib.PDFDocument.load(bytes);

        const pages = await pdfFinal.copyPages(
          pdfOrigen,
          [item.page - 1]
        );
        pdfFinal.addPage(pages[0]);

      } else {
        const imgBytes = await item.file.arrayBuffer();
        const img = item.file.type === "image/jpeg"
          ? await pdfFinal.embedJpg(imgBytes)
          : await pdfFinal.embedPng(imgBytes);

        const page = pdfFinal.addPage([img.width, img.height]);
        page.drawImage(img, { x:0, y:0, width:img.width, height:img.height });
      }
    }

    const pdfBytes = await pdfFinal.save();
    saveAs(new Blob([pdfBytes], { type:"application/pdf" }), "documentacion.pdf");

  } else {
    const zip = new JSZip();

    for (const item of filesData) {
      if (item.file.type === "application/pdf") {
        zip.file(item.input.value + ".pdf", await item.file.arrayBuffer());
      } else {
        const pdf = await PDFLib.PDFDocument.create();
        const bytes = await item.file.arrayBuffer();
        const img = item.file.type === "image/jpeg"
          ? await pdf.embedJpg(bytes)
          : await pdf.embedPng(bytes);

        const page = pdf.addPage([img.width, img.height]);
        page.drawImage(img, { x:0, y:0, width:img.width, height:img.height });

        zip.file(item.input.value + ".pdf", await pdf.save());
      }
    }

    const zipBlob = await zip.generateAsync({ type:"blob" });
    saveAs(zipBlob, "documentacion.zip");
  }
}
</script>

</body>
</html>













